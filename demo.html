<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vibe Player Demo - Live Preview</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #0a0a0a;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    .header {
      padding: 20px;
      background: #1a1a1a;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .header h1 {
      font-size: 24px;
      margin-bottom: 8px;
    }

    .header p {
      color: rgba(255,255,255,0.6);
      font-size: 14px;
    }

    .controls {
      padding: 20px;
      background: #1a1a1a;
      display: flex;
      gap: 16px;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 24px;
      background: #00D4FF;
      border: none;
      border-radius: 8px;
      color: #0a0a0a;
      font-weight: 600;
      cursor: pointer;
      transition: all 200ms ease;
    }

    .btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 20px rgba(0, 212, 255, 0.4);
    }

    .btn:active {
      transform: scale(0.95);
    }

    .btn.secondary {
      background: rgba(255,255,255,0.1);
      color: white;
    }

    .preview-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      position: relative;
    }

    .phone-frame {
      width: 100%;
      max-width: 375px;
      height: 100%;
      max-height: 812px;
      background: #1a1a1a;
      border-radius: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      padding: 10px;
      position: relative;
      overflow: hidden;
    }

    .phone-screen {
      width: 100%;
      height: 100%;
      background: #000;
      border-radius: 30px;
      overflow: hidden;
      position: relative;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .status {
      position: absolute;
      top: 20px;
      right: 20px;
      padding: 8px 16px;
      background: rgba(0,0,0,0.8);
      border-radius: 20px;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: #30D158;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .instructions {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      padding: 16px 24px;
      border-radius: 12px;
      text-align: center;
      font-size: 14px;
    }

    .visualization-info {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .viz-tag {
      padding: 4px 12px;
      background: rgba(255,255,255,0.1);
      border-radius: 16px;
      font-size: 12px;
    }
  </style>
</head>
<body>
  <div class="header">
    <h1>ðŸŽµ Vibe Player - Live Preview</h1>
    <p>High-performance audio visualizer with 9 visualization modes</p>
  </div>

  <div class="controls">
    <button class="btn" onclick="loadTestAudio()">Load Test Audio</button>
    <button class="btn secondary" onclick="reloadFrame()">Reload App</button>
    <button class="btn secondary" onclick="toggleFullscreen()">Fullscreen</button>
  </div>

  <div class="preview-container">
    <div class="phone-frame">
      <div class="phone-screen">
        <iframe id="vibe-frame" src="index.html"></iframe>
      </div>
    </div>
    
    <div class="status">
      <div class="status-dot"></div>
      <span>Live Preview</span>
    </div>
    
    <div class="instructions">
      <strong>Instructions:</strong> Click "Load Test Audio" to generate a test file
      <div class="visualization-info">
        <span class="viz-tag">Bars</span>
        <span class="viz-tag">Wave</span>
        <span class="viz-tag">Circle</span>
        <span class="viz-tag">Particles</span>
        <span class="viz-tag">Galaxy</span>
        <span class="viz-tag">DNA</span>
        <span class="viz-tag">Ribbons</span>
        <span class="viz-tag">Fractal</span>
        <span class="viz-tag">Neon Grid</span>
      </div>
    </div>
  </div>

  <script>
    // Generate test audio data
    function generateTestAudio() {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const sampleRate = audioContext.sampleRate;
      const duration = 30; // 30 seconds
      const numberOfChannels = 2;
      const length = sampleRate * duration;
      
      const buffer = audioContext.createBuffer(numberOfChannels, length, sampleRate);
      
      // Generate a complex test pattern with multiple frequencies
      for (let channel = 0; channel < numberOfChannels; channel++) {
        const channelData = buffer.getChannelData(channel);
        for (let i = 0; i < length; i++) {
          const t = i / sampleRate;
          
          // Mix of frequencies for interesting visualizations
          channelData[i] = 
            0.3 * Math.sin(2 * Math.PI * 440 * t) +  // A4
            0.2 * Math.sin(2 * Math.PI * 880 * t) +  // A5
            0.2 * Math.sin(2 * Math.PI * 220 * t) +  // A3
            0.1 * Math.sin(2 * Math.PI * 110 * t) +  // A2 (bass)
            0.1 * Math.sin(2 * Math.PI * 1760 * t) + // A6 (high)
            0.1 * (Math.random() - 0.5);             // Some noise
          
          // Add beat pattern
          if (t % 0.5 < 0.1) {
            channelData[i] += 0.5 * Math.sin(2 * Math.PI * 55 * t);
          }
        }
      }
      
      return buffer;
    }

    function bufferToWave(buffer) {
      const length = buffer.length * buffer.numberOfChannels * 2 + 44;
      const arrayBuffer = new ArrayBuffer(length);
      const view = new DataView(arrayBuffer);
      const channels = [];
      const sampleRate = buffer.sampleRate;
      const bitDepth = 16;
      
      // Write WAV header
      const writeString = (offset, string) => {
        for (let i = 0; i < string.length; i++) {
          view.setUint8(offset + i, string.charCodeAt(i));
        }
      };
      
      writeString(0, 'RIFF');
      view.setUint32(4, length - 8, true);
      writeString(8, 'WAVE');
      writeString(12, 'fmt ');
      view.setUint32(16, 16, true);
      view.setUint16(20, 1, true);
      view.setUint16(22, buffer.numberOfChannels, true);
      view.setUint32(24, sampleRate, true);
      view.setUint32(28, sampleRate * buffer.numberOfChannels * bitDepth / 8, true);
      view.setUint16(32, buffer.numberOfChannels * bitDepth / 8, true);
      view.setUint16(34, bitDepth, true);
      writeString(36, 'data');
      view.setUint32(40, length - 44, true);
      
      // Write audio data
      let offset = 44;
      for (let i = 0; i < buffer.length; i++) {
        for (let channel = 0; channel < buffer.numberOfChannels; channel++) {
          const sample = Math.max(-1, Math.min(1, buffer.getChannelData(channel)[i]));
          view.setInt16(offset, sample * 0x7FFF, true);
          offset += 2;
        }
      }
      
      return new Blob([arrayBuffer], { type: 'audio/wav' });
    }

    async function loadTestAudio() {
      try {
        // Generate test audio
        const audioBuffer = generateTestAudio();
        const blob = bufferToWave(audioBuffer);
        
        // Create a File object
        const file = new File([blob], 'test-audio.wav', { type: 'audio/wav' });
        
        // Send to iframe
        const iframe = document.getElementById('vibe-frame');
        
        // Wait for iframe to be ready
        setTimeout(() => {
          // Trigger file load in the iframe
          const iframeWindow = iframe.contentWindow;
          
          // Check if the player object exists
          if (iframeWindow.player && iframeWindow.player.loadAudioFile) {
            // Direct method call
            iframeWindow.player.loadAudioFile(file);
          } else {
            // Try using the file input
            const fileInput = iframeWindow.document.getElementById('file-input');
            if (fileInput) {
              // Create a new FileList-like object
              const dt = new DataTransfer();
              dt.items.add(file);
              fileInput.files = dt.files;
              
              // Trigger change event
              const event = new Event('change', { bubbles: true });
              fileInput.dispatchEvent(event);
            }
          }
        }, 1500);
        
      } catch (error) {
        console.error('Error generating test audio:', error);
        alert('Error generating test audio. Please try again.');
      }
    }

    function reloadFrame() {
      const iframe = document.getElementById('vibe-frame');
      iframe.src = iframe.src;
    }

    function toggleFullscreen() {
      const frame = document.querySelector('.phone-frame');
      if (!document.fullscreenElement) {
        frame.requestFullscreen();
      } else {
        document.exitFullscreen();
      }
    }
  </script>
</body>
</html>