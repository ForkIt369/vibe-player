<!DOCTYPE html>
<html>
<head>
    <title>Vibe Player Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #0a0a0a;
            color: white;
            font-family: monospace;
        }
        .info {
            margin: 20px 0;
            padding: 20px;
            background: #1a1a1a;
            border-radius: 8px;
        }
        .error {
            color: #ff3b30;
        }
        .success {
            color: #30d158;
        }
    </style>
</head>
<body>
    <h1>Vibe Player Module Test</h1>
    
    <div class="info" id="status">
        <h2>Loading modules...</h2>
    </div>
    
    <div class="info" id="results">
        <h2>Test Results:</h2>
        <ul id="test-list"></ul>
    </div>
    
    <script type="module">
        const status = document.getElementById('status');
        const testList = document.getElementById('test-list');
        
        function addTest(name, success, details = '') {
            const li = document.createElement('li');
            li.className = success ? 'success' : 'error';
            li.textContent = `${success ? '✅' : '❌'} ${name} ${details ? `- ${details}` : ''}`;
            testList.appendChild(li);
        }
        
        try {
            // Test imports
            status.innerHTML = '<h2>Testing imports...</h2>';
            
            const modules = await Promise.all([
                import('./src/utils/circular-buffer.js'),
                import('./src/utils/object-pool.js'),
                import('./src/utils/particle-pool.js'),
                import('./src/utils/vector-pool.js'),
                import('./src/core/quality-profiles.js'),
                import('./src/core/performance-monitor.js'),
                import('./src/core/adaptive-quality.js'),
                import('./vibe-player-modular.js')
            ]);
            
            addTest('All modules imported successfully', true);
            
            // Test CircularBuffer
            const CircularBuffer = modules[0].default;
            const buffer = new CircularBuffer(10);
            buffer.push(5);
            buffer.push(10);
            addTest('CircularBuffer', buffer.average() === 7.5, `Average: ${buffer.average()}`);
            
            // Test ObjectPool
            const ObjectPool = modules[1].default;
            const pool = new ObjectPool(() => ({ x: 0 }), (obj) => { obj.x = 0; });
            const obj = pool.acquire();
            addTest('ObjectPool', obj && obj.x === 0, 'Object acquired');
            
            // Test QualityProfiles
            const QualityProfiles = modules[4].default;
            addTest('QualityProfiles', QualityProfiles.high && QualityProfiles.high.particles === 200, 'Profiles loaded');
            
            // Test VibePlayer
            const VibePlayer = modules[7].default;
            addTest('VibePlayer class imported', typeof VibePlayer === 'function', 'Class available');
            
            status.innerHTML = '<h2 class="success">All tests passed! ✅</h2><p>The performance optimization system is ready to use.</p>';
            
        } catch (error) {
            status.innerHTML = `<h2 class="error">Error loading modules:</h2><pre>${error.message}\n${error.stack}</pre>`;
            addTest('Module loading', false, error.message);
        }
    </script>
</body>
</html>