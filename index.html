<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#0a0a0a">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Vibe Player - Audio Visualizer</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="styles-mobile.css">
  <link rel="stylesheet" href="src/styles/broverse-vibe.css">
  <style>
    /* Quick fixes for icons and layout */
    .screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      display: none;
      z-index: 100;
      background: var(--bg-primary, #0a0a0a);
    }
    
    .screen.active {
      display: flex;
      flex-direction: column;
    }
    
    .playlist-container {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }
    
    .playlist-header {
      text-align: center;
      margin-bottom: 30px;
    }
    
    .playlist-title {
      font-size: 2.5rem;
      font-weight: 800;
      background: linear-gradient(135deg, #512FC9, #00E0FF);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 10px;
    }
    
    .playlist-subtitle {
      color: rgba(255, 255, 255, 0.6);
      font-size: 1rem;
    }
    
    .track-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 500px;
      margin: 0 auto;
    }
    
    .track-item {
      background: rgba(255, 255, 255, 0.02);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.05);
      border-radius: 16px;
      padding: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .track-item:hover {
      background: rgba(255, 255, 255, 0.04);
      border-color: var(--bro-primary);
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(255, 149, 0, 0.2);
    }
    
    .track-icon {
      font-size: 2rem;
      min-width: 40px;
      text-align: center;
    }
    
    .track-info {
      flex: 1;
    }
    
    .track-name {
      font-weight: 600;
      font-size: 1.1rem;
      color: #fff;
      margin-bottom: 4px;
    }
    
    .track-artist {
      font-size: 0.9rem;
      color: rgba(255, 255, 255, 0.6);
    }
    
    .track-duration {
      color: rgba(255, 255, 255, 0.4);
      font-size: 0.9rem;
    }
    
    .start-btn {
      padding: 16px 40px;
      font-size: 1.2rem;
      font-weight: 600;
      background: linear-gradient(135deg, #FF9500, #FF6B00);
      border: none;
      border-radius: 28px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 20px rgba(255, 149, 0, 0.3);
    }
    
    .start-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 30px rgba(255, 149, 0, 0.4);
    }
    
    .nav-header {
      background: rgba(255, 255, 255, 0.02);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    
    .back-button {
      background: none;
      border: none;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 8px;
      transition: opacity 0.3s;
    }
    
    .back-button:hover {
      opacity: 0.7;
    }
    
    .nav-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: white;
    }
    
    .upload-section {
      margin: 30px 20px;
      text-align: center;
    }
    
    .upload-btn {
      background: rgba(255, 255, 255, 0.02);
      backdrop-filter: blur(20px);
      border: 2px dashed rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 30px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-block;
    }
    
    .upload-btn:hover {
      background: rgba(255, 255, 255, 0.04);
      border-color: var(--bigsis-primary);
      box-shadow: 0 0 30px rgba(0, 212, 255, 0.2);
    }
    
    .upload-icon {
      font-size: 3rem;
      margin-bottom: 10px;
    }
    
    .upload-text {
      color: rgba(255, 255, 255, 0.8);
      font-weight: 500;
    }
  </style>
</head>
<body>
  <!-- Main Player App (Hidden initially) -->
  <div class="app" id="app" style="display: none;">
    <div class="header-bar" id="header-bar">
      <button class="back-btn" id="back-to-playlist">
        <i class="fas fa-chevron-left"></i>
      </button>
      <h1 class="header-title app-title">Vibe Player</h1>
      <button class="menu-btn" id="menu-btn">
        <i class="fas fa-ellipsis-v"></i>
      </button>
    </div>
    
    <div class="loading-overlay" id="loading">
      <div class="loading-spinner"></div>
      <p class="loading-text">Loading audio...</p>
    </div>

    <div class="main-content">
      <div class="canvas-container">
        <canvas id="visualizer-canvas"></canvas>
      </div>

      <div class="track-info">
        <div class="track-title" id="track-title">No Track</div>
        <div class="track-artist" id="track-artist">-</div>
      </div>

      <div class="progress-bar-container">
        <div class="progress-bar" id="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="time-display">
          <span id="time-current">0:00</span>
          <span id="time-total">0:00</span>
        </div>
      </div>

      <div class="player-controls">
        <button class="control-btn btn btn-glass" id="prev-btn" title="Previous">
          <i class="fas fa-backward"></i>
        </button>
        
        <button class="control-btn play-btn btn btn-glass" id="play-pause-btn" title="Play/Pause">
          <i class="fas fa-play" id="play-icon"></i>
          <i class="fas fa-pause" id="pause-icon" style="display: none;"></i>
        </button>
        
        <button class="control-btn btn btn-glass" id="next-btn" title="Next">
          <i class="fas fa-forward"></i>
        </button>
      </div>
      
      <div class="volume-control">
        <i class="fas fa-volume-up"></i>
        <input type="range" id="volume-slider" min="0" max="100" value="70">
      </div>
    </div>

    <div class="viz-selector glass-card" id="viz-selector">
      <div class="viz-grid">
        <button class="viz-option viz-btn active" data-viz="bars" title="Bars">
          <i class="fas fa-chart-bar"></i>
        </button>
        <button class="viz-option viz-btn" data-viz="wave" title="Wave">
          <i class="fas fa-water"></i>
        </button>
        <button class="viz-option viz-btn" data-viz="circle" title="Circle">
          <i class="fas fa-circle-notch"></i>
        </button>
        <button class="viz-option viz-btn" data-viz="particles" title="Particles">
          <i class="fas fa-braille"></i>
        </button>
        <button class="viz-option viz-btn" data-viz="galaxy" title="Galaxy">
          <i class="fas fa-star"></i>
        </button>
        <button class="viz-option viz-btn" data-viz="dna" title="DNA">
          <i class="fas fa-dna"></i>
        </button>
        <button class="viz-option viz-btn" data-viz="ribbons" title="Ribbons">
          <i class="fas fa-stream"></i>
        </button>
        <button class="viz-option viz-btn" data-viz="fractal" title="Fractal">
          <i class="fas fa-snowflake"></i>
        </button>
        <button class="viz-option viz-btn" data-viz="neon" title="Neon">
          <i class="fas fa-th"></i>
        </button>
      </div>
    </div>

    <div class="bottom-bar">
      <button class="action-btn" id="share-btn" title="Share">
        <i class="fas fa-share-alt"></i>
        <span>Share</span>
      </button>
      <button class="action-btn" id="record-btn" title="Record">
        <i class="fas fa-video"></i>
        <span>Record</span>
      </button>
      <button class="action-btn" id="playlist-btn" title="Playlist">
        <i class="fas fa-list"></i>
        <span>Playlist</span>
      </button>
    </div>
  </div>

  <!-- Intro Screen -->
  <div class="screen intro-screen active" id="intro-screen">
    <div class="intro-content" style="flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px 20px;">
      <div class="intro-logo" style="text-align: center; margin-bottom: 40px;">
        <div class="logo-animation" style="position: relative; width: 150px; height: 150px; margin: 0 auto 30px;">
          <div class="wave-circle" style="position: absolute; width: 100%; height: 100%; border: 2px solid var(--bigsis-primary); border-radius: 50%; animation: wave-expand 3s ease-out infinite;"></div>
          <div class="wave-circle" style="position: absolute; width: 100%; height: 100%; border: 2px solid var(--bro-primary); border-radius: 50%; animation: wave-expand 3s ease-out infinite 1s;"></div>
          <div class="wave-circle" style="position: absolute; width: 100%; height: 100%; border: 2px solid var(--lilsis-primary); border-radius: 50%; animation: wave-expand 3s ease-out infinite 2s;"></div>
          <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 4rem;">üéµ</div>
        </div>
        <h1 class="app-title" style="font-size: 3rem; font-weight: 800; background: linear-gradient(135deg, #512FC9, #00E0FF); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 10px;">VIBE PLAYER</h1>
        <p class="app-tagline" style="color: rgba(255, 255, 255, 0.6); font-size: 1.1rem;">Feel the Music, See the Vibes</p>
      </div>
      
      <button class="start-btn" id="start-btn">
        <i class="fas fa-play-circle"></i> Start Vibing
      </button>
      
      <div class="intro-features" style="display: flex; gap: 30px; margin-top: 40px; color: rgba(255, 255, 255, 0.8);">
        <div class="feature" style="text-align: center;">
          <div style="font-size: 2rem; margin-bottom: 8px;">üé®</div>
          <div style="font-size: 0.9rem;">9 Modes</div>
        </div>
        <div class="feature" style="text-align: center;">
          <div style="font-size: 2rem; margin-bottom: 8px;">üéµ</div>
          <div style="font-size: 0.9rem;">15 Tracks</div>
        </div>
        <div class="feature" style="text-align: center;">
          <div style="font-size: 2rem; margin-bottom: 8px;">üé¨</div>
          <div style="font-size: 0.9rem;">Record</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Playlist Screen -->
  <div class="screen playlist-screen" id="playlist-screen">
    <div class="nav-header">
      <button class="back-button" id="back-to-intro">
        <i class="fas fa-arrow-left"></i>
      </button>
      <div class="nav-title">Music Library</div>
      <div style="width: 40px;"></div>
    </div>
    
    <div class="playlist-container">
      <div class="playlist-header">
        <h2 class="playlist-title">Vibe Tracks</h2>
        <p class="playlist-subtitle">Select a track to start vibing</p>
      </div>
      
      <div class="track-list" id="track-list">
        <!-- Tracks will be populated here -->
      </div>
      
      <div class="upload-section">
        <label for="file-input" class="upload-btn">
          <div class="upload-icon">üìÅ</div>
          <div class="upload-text">Upload Your Own Track</div>
        </label>
        <input type="file" id="file-input" accept="audio/*" style="display: none;">
      </div>
    </div>
  </div>

  <!-- Define tracks data -->
  <script>
    window.TRACKS = [
      {
        title: "Global Concepts",
        artist: "Robert DeLong",
        file: "audio/Robert_DeLong-Global_Concepts.mp3",
        duration: "3:42",
        icon: "üé∏"
      },
      {
        title: "Chlorine",
        artist: "twenty one pilots",
        file: "audio/Twenty_One_Pilots-Chlorine.mp3",
        duration: "5:24",
        icon: "üéπ"
      },
      {
        title: "11 Minutes",
        artist: "YUNGBLUD, Halsey ft. Travis Barker",
        file: "audio/YUNGBLUD_Halsey-11_Minutes.mp3",
        duration: "3:41",
        icon: "üé§"
      },
      {
        title: "Gasoline",
        artist: "Halsey",
        file: "audio/Halsey-Gasoline.mp3",
        duration: "3:17",
        icon: "üî•"
      },
      {
        title: "High Enough",
        artist: "K.Flay",
        file: "audio/K_Flay-High_Enough.mp3",
        duration: "3:50",
        icon: "üåü"
      },
      {
        title: "Zen",
        artist: "X Ambassadors, K.Flay, grandson",
        file: "audio/X_Ambassadors_K_Flay-Zen.mp3",
        duration: "3:37",
        icon: "‚òØÔ∏è"
      },
      {
        title: "Handlebars",
        artist: "Flobots",
        file: "audio/Flobots - Handlebars (Official Video).mp3",
        duration: "3:31",
        icon: "üö¥"
      },
      {
        title: "Party Favor - Superhuman",
        artist: "Party Favor (with K.Flay)",
        file: "audio/Party Favor - Superhuman (with K.Flay) (Visualizer) [Ultra Music].mp3",
        duration: "4:02",
        icon: "‚ö°"
      },
      {
        title: "Heavy",
        artist: "Linkin Park ft. Kiiara",
        file: "audio/Linkin Park - Heavy (feat. Kiiara) [Official Lyric Video].mp3",
        duration: "2:49",
        icon: "üí´"
      },
      {
        title: "Neon Gravestones",
        artist: "twenty one pilots",
        file: "audio/twenty one pilots - Neon Gravestones (Official Audio).mp3",
        duration: "4:00",
        icon: "üåà"
      },
      {
        title: "My Blood",
        artist: "twenty one pilots",
        file: "audio/Twenty_One_Pilots-My_Blood.mp3",
        duration: "3:49",
        icon: "‚ù§Ô∏è"
      },
      {
        title: "Nico And The Niners",
        artist: "twenty one pilots",
        file: "audio/Twenty_One_Pilots-Nico_And_The_Niners.mp3",
        duration: "3:45",
        icon: "üî•"
      },
      {
        title: "The Climb Back",
        artist: "J. Cole",
        file: "audio/J. Cole - The Climb Back (Official Audio).mp3",
        duration: "5:02",
        icon: "üèîÔ∏è"
      },
      {
        title: "Drugs You Should Try It",
        artist: "Travis Scott",
        file: "audio/Travis Scott - Drugs You Should Try It (Audio).mp3",
        duration: "3:27",
        icon: "üåµ"
      },
      {
        title: "Long Time",
        artist: "Robert DeLong",
        file: "audio/default-song.mp3",
        duration: "3:42",
        icon: "üéµ"
      }
    ];
  </script>

  <!-- Load scripts -->
  <script src="vibe-player.js"></script>
  <script src="src/screens/playlist-manager.js"></script>
  <script>
    // Simple navigation controller
    class SimpleController {
      constructor() {
        this.currentTrackIndex = 0;
        this.tracks = window.TRACKS;
        this.vibePlayer = null;
        this.init();
      }
      
      init() {
        // Initialize screens
        this.introScreen = document.getElementById('intro-screen');
        this.playlistScreen = document.getElementById('playlist-screen');
        this.playerApp = document.getElementById('app');
        
        // Populate playlist
        this.populatePlaylist();
        
        // Setup navigation
        this.setupNavigation();
        
        // Initialize Telegram WebApp
        const tg = window.Telegram?.WebApp;
        if (tg) {
          tg.ready();
          tg.expand();
        }
      }
      
      populatePlaylist() {
        const trackList = document.getElementById('track-list');
        trackList.innerHTML = '';
        
        this.tracks.forEach((track, index) => {
          const trackItem = document.createElement('div');
          trackItem.className = 'track-item';
          trackItem.innerHTML = `
            <div class="track-icon">${track.icon}</div>
            <div class="track-info">
              <div class="track-name">${track.title}</div>
              <div class="track-artist">${track.artist}</div>
            </div>
            <div class="track-duration">${track.duration}</div>
          `;
          trackItem.addEventListener('click', () => this.playTrack(index));
          trackList.appendChild(trackItem);
        });
      }
      
      setupNavigation() {
        // Start button
        document.getElementById('start-btn').addEventListener('click', () => {
          this.showScreen('playlist');
        });
        
        // Back buttons
        document.getElementById('back-to-intro').addEventListener('click', () => {
          this.showScreen('intro');
        });
        
        document.getElementById('back-to-playlist').addEventListener('click', () => {
          if (this.vibePlayer) {
            this.vibePlayer.stop();
          }
          this.showScreen('playlist');
        });
        
        // Playlist button in player
        document.getElementById('playlist-btn').addEventListener('click', () => {
          this.showScreen('playlist');
        });
        
        // Record button
        document.getElementById('record-btn').addEventListener('click', () => {
          alert('Recording feature coming soon! üé¨\n\nWill record visualization + audio for sharing on X (Twitter)');
        });
        
        // Share button
        document.getElementById('share-btn').addEventListener('click', () => {
          if (window.Telegram?.WebApp) {
            window.Telegram.WebApp.shareText('Check out Vibe Player - Amazing audio visualizer! üéµ');
          }
        });
        
        // Player controls
        document.getElementById('prev-btn').addEventListener('click', () => this.previousTrack());
        document.getElementById('next-btn').addEventListener('click', () => this.nextTrack());
      }
      
      showScreen(screen) {
        // Hide all screens
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        this.playerApp.style.display = 'none';
        
        // Show selected screen
        switch(screen) {
          case 'intro':
            this.introScreen.classList.add('active');
            break;
          case 'playlist':
            this.playlistScreen.classList.add('active');
            break;
          case 'player':
            this.playerApp.style.display = 'block';
            break;
        }
      }
      
      async playTrack(index) {
        this.currentTrackIndex = index;
        const track = this.tracks[index];
        
        // Show player
        this.showScreen('player');
        
        // Initialize vibe player if not already
        if (!this.vibePlayer) {
          this.vibePlayer = new VibePlayer();
          this.vibePlayer.init();
        }
        
        // Update track info
        document.getElementById('track-title').textContent = track.title;
        document.getElementById('track-artist').textContent = track.artist;
        
        // Load and play track
        try {
          await this.vibePlayer.loadFile(track.file);
        } catch (error) {
          console.error('Error loading track:', error);
          alert('Error loading track. Please try another one.');
          this.showScreen('playlist');
        }
      }
      
      previousTrack() {
        if (this.currentTrackIndex > 0) {
          this.playTrack(this.currentTrackIndex - 1);
        } else {
          this.playTrack(this.tracks.length - 1);
        }
      }
      
      nextTrack() {
        if (this.currentTrackIndex < this.tracks.length - 1) {
          this.playTrack(this.currentTrackIndex + 1);
        } else {
          this.playTrack(0);
        }
      }
    }
    
    // Initialize when DOM is ready
    document.addEventListener('DOMContentLoaded', () => {
      window.controller = new SimpleController();
    });
  </script>
</body>
</html>